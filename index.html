<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI 学习助手 - 智能解题，拍照或输入题目即可获得详细解答">
    <title>AI 学习助手 - 智能解题</title>
    <link rel="stylesheet" href="css/style.css">
    <script>
        // 页面加载时检查登录状态
        document.addEventListener('DOMContentLoaded', () => {
            if (!localStorage.getItem('ai_learning_assistant_token')) {
                window.location.href = 'home.html';
            }
        });
    </script>
</head>

<body>
    <div class="app-container">
        <!-- 顶部标题栏 -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                    </svg>
                    <h1>AI 学习助手</h1>
                </div>
                <p class="subtitle">拍照或输入题目，获取详细解答</p>
            </div>
            <div class="header-right">
                <!-- 未登录显示登录/注册按钮 -->
                <div id="auth-buttons" class="auth-btns" style="display: none;">
                    <a href="home.html" class="btn btn-secondary">登录</a>
                    <a href="home.html?tab=register" class="btn btn-primary">注册</a>
                </div>
                <!-- 已登录显示用户信息 -->
                <div id="user-info" class="user-info" style="display: none;">
                    <div class="user-avatar" id="user-avatar">U</div>
                    <span class="user-name" id="user-name">用户名</span>
                    <button class="user-logout-btn" id="logout-btn">退出</button>
                </div>
            </div>
        </header>

        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 输入区域 -->
            <section class="input-section">
                <!-- 输入方式切换 Tab -->
                <div class="input-tabs">
                    <button class="tab-btn active" data-tab="text">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                        </svg>
                        文字输入
                    </button>
                    <button class="tab-btn" data-tab="image">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                            <circle cx="8.5" cy="8.5" r="1.5" />
                            <polyline points="21 15 16 10 5 21" />
                        </svg>
                        图片输入
                    </button>
                </div>

                <!-- 文字输入区域 -->
                <div class="input-panel active" id="text-panel">
                    <div class="text-input-wrapper">
                        <textarea id="text-input" class="text-input"
                            placeholder="请输入题目内容，支持数学公式、化学方程式等...&#10;例如：求解一元二次方程 x² + 2x - 3 = 0" rows="6"></textarea>
                        <div class="text-input-footer">
                            <span class="char-count">0 / 2000</span>
                            <button class="clear-btn" id="clear-text">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path
                                        d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                                </svg>
                                清空
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 图片输入区域 -->
                <div class="input-panel" id="image-panel">
                    <div class="image-upload-wrapper">
                        <div class="upload-area" id="upload-area">
                            <input type="file" id="image-input" class="image-input"
                                accept="image/jpeg,image/png,image/jpg" hidden>
                            <div class="upload-placeholder">
                                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                    <polyline points="17 8 12 3 7 8" />
                                    <line x1="12" y1="3" x2="12" y2="15" />
                                </svg>
                                <p class="upload-text">点击或拖拽上传题目图片</p>
                                <p class="upload-hint">支持 JPG、PNG 格式，最大 5MB</p>
                            </div>
                        </div>
                        <div class="image-preview-wrapper" id="image-preview-wrapper" style="display: none;">
                            <img id="image-preview" class="image-preview" alt="题目预览">
                            <div class="image-info">
                                <span id="image-size"></span>
                                <button class="remove-image-btn" id="remove-image">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="18" y1="6" x2="6" y2="18" />
                                        <line x1="6" y1="6" x2="18" y2="18" />
                                    </svg>
                                    删除图片
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 提交按钮 -->
                <button class="submit-btn" id="submit-btn" disabled>
                    <span class="btn-text">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10" />
                            <path d="M12 6v6l4 2" />
                        </svg>
                        开始解答
                    </span>
                    <span class="btn-loading" style="display: none;">
                        <svg class="spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10" stroke-dasharray="60" stroke-dashoffset="10" />
                        </svg>
                        处理中...
                    </span>
                </button>
            </section>

            <!-- 步骤指示器 -->
            <section class="progress-section" id="progress-section" style="display: none;">
                <div class="progress-steps">
                    <div class="step" data-step="1">
                        <div class="step-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                                <circle cx="8.5" cy="8.5" r="1.5" />
                                <polyline points="21 15 16 10 5 21" />
                            </svg>
                        </div>
                        <span class="step-label">识别题目</span>
                    </div>
                    <div class="step-connector"></div>
                    <div class="step" data-step="2">
                        <div class="step-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                                <polyline points="14 2 14 8 20 8" />
                                <line x1="16" y1="13" x2="8" y2="13" />
                                <line x1="16" y1="17" x2="8" y2="17" />
                                <polyline points="10 9 9 9 8 9" />
                            </svg>
                        </div>
                        <span class="step-label">解析分析</span>
                    </div>
                    <div class="step-connector"></div>
                    <div class="step" data-step="3">
                        <div class="step-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 11l3 3L22 4" />
                                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
                            </svg>
                        </div>
                        <span class="step-label">生成解答</span>
                    </div>
                </div>
            </section>

            <!-- 结果展示区域 -->
            <section class="result-section" id="result-section" style="display: none;">
                <!-- 题目识别结果 -->
                <div class="result-card" id="recognition-card">
                    <div class="card-header">
                        <h3>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                                <circle cx="8.5" cy="8.5" r="1.5" />
                                <polyline points="21 15 16 10 5 21" />
                            </svg>
                            题目识别
                        </h3>
                        <button class="toggle-btn" data-target="recognition-content">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6 9 12 15 18 9" />
                            </svg>
                        </button>
                    </div>
                    <div class="card-content" id="recognition-content">
                        <div class="recognized-text" id="recognized-text"></div>
                        <button class="edit-btn" id="edit-recognition">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                            </svg>
                            编辑
                        </button>
                    </div>
                </div>

                <!-- 题目解析结果 -->
                <div class="result-card" id="parse-card">
                    <div class="card-header">
                        <h3>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                                <polyline points="14 2 14 8 20 8" />
                                <line x1="16" y1="13" x2="8" y2="13" />
                                <line x1="16" y1="17" x2="8" y2="17" />
                                <polyline points="10 9 9 9 8 9" />
                            </svg>
                            题目解析
                        </h3>
                        <button class="toggle-btn" data-target="parse-content">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6 9 12 15 18 9" />
                            </svg>
                        </button>
                    </div>
                    <div class="card-content" id="parse-content">
                        <div class="parse-result" id="parse-result">
                            <div class="parse-item">
                                <span class="parse-label">题目类型</span>
                                <span class="parse-value" id="parse-type">-</span>
                            </div>
                            <div class="parse-item">
                                <span class="parse-label">所属学科</span>
                                <span class="parse-value" id="parse-subject">-</span>
                            </div>
                            <div class="parse-item">
                                <span class="parse-label">知识点</span>
                                <div class="parse-tags" id="parse-knowledge"></div>
                            </div>
                            <div class="parse-item">
                                <span class="parse-label">难度等级</span>
                                <span class="parse-value difficulty" id="parse-difficulty">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 详细解答 -->
                <div class="result-card" id="solution-card">
                    <div class="card-header">
                        <h3>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 11l3 3L22 4" />
                                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
                            </svg>
                            详细解答
                        </h3>
                        <button class="toggle-btn" data-target="solution-content">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6 9 12 15 18 9" />
                            </svg>
                        </button>
                    </div>
                    <div class="card-content" id="solution-content">
                        <div class="solution-content" id="solution-content-inner">
                            <div class="solution-section">
                                <h4>解题思路</h4>
                                <div class="solution-thinking" id="solution-thinking"></div>
                            </div>
                            <div class="solution-section">
                                <h4>详细步骤</h4>
                                <div class="solution-steps" id="solution-steps"></div>
                            </div>
                            <div class="solution-section">
                                <h4>最终答案</h4>
                                <div class="solution-answer" id="solution-answer"></div>
                            </div>
                            <div class="solution-section">
                                <h4>知识总结</h4>
                                <div class="solution-summary" id="solution-summary"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 历史记录按钮 -->
            <button class="history-btn" id="history-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10" />
                    <polyline points="12 6 12 12 16 14" />
                </svg>
                历史记录
            </button>
        </main>

        <!-- 历史记录侧边栏 -->
        <aside class="history-sidebar" id="history-sidebar">
            <div class="history-header">
                <h2>历史记录</h2>
                <button class="close-history" id="close-history">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="history-list" id="history-list">
                <!-- 历史记录项将动态插入这里 -->
            </div>
        </aside>

        <!-- 遮罩层 -->
        <div class="overlay" id="overlay"></div>
    </div>

    <!-- 引入 JavaScript 文件 -->
    <script src="js/user.js"></script>
    <script src="js/main.js"></script>
</body>

</html>